$(function(){var s=function(){$(".verify-img").attr("src",imoocSSO.verifyCodeUrl+"?t="+(new Date).getTime()),$(".js-input-verify").val("")},e=function(){$(".verify-wrap").append($('<img class="verify-img"/>')),s()},t={checkName:function(){var s=$(this);/^[0-9]*$/.test(s.val())?s.attr("data-validate","require-mobile-phone"):-1==s.val().indexOf("+")?s.attr("data-validate","require-email"):s.attr("data-validate","")},sendVoice:function(){var s=this;if(!$(this).hasClass("disabled")&&($(this).text("发送中...").attr("disabled","disabled").addClass("disabled"),W.validate($(".js-input-name"))&&W.validate($(".js-input-verify")))){var e={number:$(".js-input-name").val(),verify:$(".js-input-verify").val(),typecode:1};$.ajax({url:"/passport/user/resetpass",data:e,method:"post",dataType:"json",success:function(i){10001==i.status?($(".js-register-phone").text(e.number),$(".js-phone-verify").removeClass("sms-verify"),$(".js-btn-send").html('<div class="send-timer js-btn-send">重新获取<span>60</span></div>'),$(".step1").hide(),$(".step3").show(),t.showPhoneVerity()):(11001==i.status&&$(s).attr("disabled","disabled").addClass("disabled"),$(".js-error").show().html(i.msg))},error:function(){$(".js-error").show().html("服务错误，稍后重试")},complete:function(){$(s).html("语音验证码").removeAttr("disabled").removeClass("disabled")}})}},submitForm:function(){if(!$(".js-btn-submit").hasClass("disabled")&&($(".js-error").hide(),W.validate($(".js-input-name"))&&W.validate($(".js-input-verify")))){$(".js-btn-submit").text("正在提交...").attr("disabled","disabled").addClass("disabled");var e={username:$(".js-input-name").val(),verify:$(".js-input-verify").val()};$.ajax(e.username.indexOf("@")>=0?{url:"/passport/user/emailresetpass",data:{useremail:e.username,verify:e.verify},method:"post",dataType:"json",success:function(t){10001===t.status?($(".step1").hide(),$(".js-register-email").html(e.username),$(".step2").show()):(s(),$(".js-error").show().html(t.msg))},error:function(){$(".js-error").show().html("服务错误，稍后重试")},complete:function(){$(".js-btn-submit").html("提交").removeAttr("disabled").removeClass("disabled")}}:{url:"/passport/user/resetpass",data:{number:e.username,verify:e.verify},method:"post",dataType:"json",success:function(i){10001==i.status?($(".js-register-phone").text(e.username),$(".js-phone-verify").removeClass("sms-verify"),$(".js-btn-send").html('<div class="send-timer js-btn-send">重新获取<span>60</span></div>'),$(".step1").hide(),$(".step3").show(),t.showPhoneVerity()):(s(),$(".js-error").show().html(i.msg))},error:function(){$(".js-error").show().html("服务错误，稍后重试")},complete:function(){$(".js-btn-submit").html("提交").removeAttr("disabled").removeClass("disabled")}})}},showPhoneVerity:function(){var s=$(".js-btn-send span").text();if(s>1)s--,$(".js-btn-send span").text(s),setTimeout(t.showPhoneVerity,1e3);else{var e='<a href="javascript:void(0)" class="btn-send-verify js-btn-resend">重发短信</a>';-1==$(".js-input-name").val().indexOf("+")&&(e+='<a href="javascript:void(0)" class="btn-send-verify js-btn-voice">语音验证码</a>'),$(".js-phone-verify").addClass("sms-verify"),$(".js-btn-send").html(e)}},phoneRegister:function(){var s=this;if($(".js-error").hide(),!$(this).hasClass("disabled")&&W.validate($(".js-phone-verify"))&&W.validate($(".js-input-password"))){var e={number:$(".js-input-name").val(),mobileverify:$(".js-phone-verify").val(),password:$(".js-input-password").val(),type:1};$(this).text("正在提交...").attr("disabled","disabled").addClass("disabled"),$.ajax({url:"/passport/user/resetpass",data:e,method:"post",dataType:"json",success:function(s){10001==s.status?($(".step3").hide(),$(".step4").show(),t.registerSuccess()):$(".js-error").show().html(s.msg)},error:function(){$(".js-error").show().html("服务错误，稍后重试")},complete:function(){$(s).text("提交").removeAttr("disabled").removeClass("disabled")}})}},registerSuccess:function(){var s=$(".js-jump-timer").text();s>1?(s--,$(".js-jump-timer").text(s),setTimeout(registerEvent.registerSuccess,1e3)):window.location.replace("../../../../../index.htm"/*tpa=https://m.imooc.com/*/)}},i=function(){e(),$(".js-showpw").on("click",function(){var s=$(this).prev("input");"password"==s.attr("type")?(s.attr("type","text"),$(this).removeClass("imwap-visibility_off")):(s.attr("type","password"),$(this).addClass("imwap-visibility_off"))}),$(".js-input-name").on("keyup",function(){t.checkName.call(this)}),$(".account-form").on("click",".verify-img",s).on("click",".js-btn-submit",t.submitForm).on("click",".js-btn-resend",t.submitForm).on("click",".js-btn-register",t.phoneRegister).on("click",".js-btn-voice",t.sendVoice).on("click",".js-goback",function(){$(".step3").hide(),$(".step1").show()})},a=function(){i()};a()});