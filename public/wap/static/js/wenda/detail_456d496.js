$(function(){var s=20,a=1,i=window.location.href,t=urlParse(i);if(t.id=wendaID,$(".js-issue-box").size()>0){var e=!1;if($(".js-topic-desc").height()>2*parseInt($("body").css("fontSize"))){var o='<div class="more-desc-btn"><a href="javascript:void(0);" class="js-more-desc">查看更多</a></div>';$(".js-topic-desc").addClass("ellipsis2"),$(".js-issue-box").append(o)}$(".js-issue-box").on("click",".js-more-desc",function(){e?(e=!1,$(".js-topic-desc").addClass("ellipsis2"),$(this).text("查看全部")):(e=!0,$(".js-topic-desc").removeClass("ellipsis2"),$(this).text("收起全部"))})}if($(".js-load-more").size()>0&&$(".js-load-more").on("click",function(){a++,$.ajax({url:"/wap/api/wenda/issuedetailmore?id="+t.id+"&page="+a,type:"get",dataType:"json",success:function(a){for(var i="",t=0;t<a.data.length;t++){var e="",o="",d="";a.data[t].labels&&(e='<p class="from">来自 '+a.data[t].labels+"<span>"+a.data[t].answers+"个回答</span></p>"),a.data[t].top_reply?(o=1==a.data[t].top_reply.best_answer?'<p class="label">已采纳回答</p>':'<p class="label">最赞的回答</p>',o+='<div class="answer">'+a.data[t].top_reply.description+"</div>"):(d=a.data[t].followed?'<a href="javascript:void(0);" class="followed"><i class="imwap-collection"></i>已关注</a>':'<a href="javascript:void(0);"><i class="imwap-collection"></i>关注</a>',o='<div class="action clearfix"><a href="javascript:void(0);"><i class=""></i>我要回答</a>'+d+"</div>"),i+='<dd>								<img src="'+a.data[t].label_pic+'">								'+e+'								<p class="title">'+a.data[t].title+"</p>								"+o+"							</dd>"}a.data.length<s&&$(".js-load-more").remove(),$(".js-issue-list").append(i)}})}),$(".js-more-answer").size()>0&&(prettyPrint(),$(".js-more-answer").on("click",function(){a++,$.ajax({url:"/wap/api/wenda/wendadetailmore?id="+t.id+"&page="+a,type:"get",dataType:"json",success:function(a){for(var i="",t=0;t<a.data.length;t++){var e="/account/login";isLogin&&(e="http://www.imooc.com/m/web/wenda/replyList.html?bbsid="+a.data[t].bbs_id+"&&replyid="+a.data[t].id);var o="",d="";0==a.data[t].op?o="active":1==a.data[t].op&&(d="active"),i+='<dd><img src="'+a.data[t].userinfo.pic+'" class="avator"><p class="name">'+a.data[t].userinfo.nickname+'</p><div class="content">'+a.data[t].description+'</div><div class="action clearfix"><div class="l"><a href="javascript:void(0);" data-flag="support" class="like js-is-support js-support '+o+'"><i class="imwap-thumb_up"></i><span class="js-support-num">'+a.data[t].support_num+'</span></a><a href="javascript:void(0);" data-flag="unsupport" class="like js-is-support js-unsupport '+d+'"><i class="imwap-thumb_down"></i><span class="js-support-num">'+a.data[t].unsupport_num+'</span></a></div><div class="r"><a href="'+e+'">'+a.data[t].reply_num+'<i class="imwap-comment"></i></a></div></div></dd>'}a.data.length<s&&$(".js-more-answer").remove(),$(".js-answer-list").append(i)}})})),$(".js-favorite").size()>0){var d={},p=!1;$(".js-favorite").on("click",function(){var s=$(this);return isLogin||(window.location.href="../../../../../account/login.htm"/*tpa=https://m.imooc.com/account/login*/),p?!1:(d.id=$(".js-issue-list").size()>0?s.attr("data-id"):t.id,p=!0,d.type=s.hasClass("active")?"del":"add",void $.ajax({url:"/wap/api/wenda/favorite",type:"get",data:d,dataType:"json",success:function(a){1e3==a.data.errorCode&&("del"https://m.imooc.com/static/wap/static/js/wenda/==d.type?($.msg("success","已取消关注"),s.removeClass("active"),$(".js-issue-list").size()>0&&s.find(".js-favorite-stat").html("关注")):($.msg("success","关注成功~"),s.addClass("active"),$(".js-issue-list").size()>0&&s.find(".js-favorite-stat").html("已关注")),p=!1)}}))})}$(".js-answer-list").size()>0&&$(".js-answer-list").on("click",".js-is-support",function(){isLogin||(window.location.href="../../../../../account/login.htm"/*tpa=https://m.imooc.com/account/login*/);var s=$(this),a={replyid:s.closest("dd").attr("id"),id:t.id};a.op="support"==s.attr("data-flag")?s.hasClass("active")?-1:0:s.hasClass("active")?-2:1,$.ajax({url:"/wap/api/wenda/support",type:"get",data:a,dataType:"json",success:function(a){var i=0,t=0;1e3==a.data.errorCode&&(s.hasClass("active")?(s.removeClass("active"),i=parseInt(s.find(".js-support-num").text())-1):(s.addClass("active"),i=parseInt(s.find(".js-support-num").text())+1),s.siblings(".js-is-support").hasClass("active")&&(s.siblings(".js-is-support").removeClass("active"),t=parseInt(s.siblings(".js-is-support").find(".js-support-num").text())-1,s.siblings(".js-is-support").find(".js-support-num").text(t)),s.find(".js-support-num").html(i))}})})});